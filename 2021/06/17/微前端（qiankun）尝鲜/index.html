<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ Techniques, strategies and recipes for building a modern web app with multiple teams that can ship features independently. â€“ Micro Frontends å¾®å‰ç«¯æ˜¯ä¸€ç§å¤šä¸ªå›¢é˜Ÿé€šè¿‡ç‹¬ç«‹å‘å¸ƒåŠŸèƒ½çš„æ–¹å¼æ¥å…±åŒæ„å»ºç°ä»£åŒ– web åº”ç”¨çš„æŠ€æœ¯æ‰‹æ®µåŠæ–¹æ³•ç­–ç•¥ã€‚  å¾®å‰">
<meta name="keywords" content="single spa,qiankun,å¾®å‰ç«¯,ä¹¾å¤">
<meta property="og:type" content="article">
<meta property="og:title" content="å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ(vue)">
<meta property="og:url" content="https://blog.cn-face.com/2021/06/17/å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ/index.html">
<meta property="og:site_name" content="ä¸€è‚¡å¼±è€…çš„æ°”æ¯">
<meta property="og:description" content="ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ Techniques, strategies and recipes for building a modern web app with multiple teams that can ship features independently. â€“ Micro Frontends å¾®å‰ç«¯æ˜¯ä¸€ç§å¤šä¸ªå›¢é˜Ÿé€šè¿‡ç‹¬ç«‹å‘å¸ƒåŠŸèƒ½çš„æ–¹å¼æ¥å…±åŒæ„å»ºç°ä»£åŒ– web åº”ç”¨çš„æŠ€æœ¯æ‰‹æ®µåŠæ–¹æ³•ç­–ç•¥ã€‚  å¾®å‰">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://blog.cn-face.com/images/micro.png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy93Uk5sV0tuMEE1TXdpYWo4MmtYdmNCN09HaWFlVGljMkdOcjZEMEMxTFQ1Wmg0aWFpY2VpYVJRSVVSWk5sb01pYU8wVkQyNXQyUjdKR3JkNDNvOWY5ZHNOZTQwancvNjQw?x-oss-process=image/format,png">
<meta property="og:updated_time" content="2024-03-06T14:21:10.959Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ(vue)">
<meta name="twitter:description" content="ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ Techniques, strategies and recipes for building a modern web app with multiple teams that can ship features independently. â€“ Micro Frontends å¾®å‰ç«¯æ˜¯ä¸€ç§å¤šä¸ªå›¢é˜Ÿé€šè¿‡ç‹¬ç«‹å‘å¸ƒåŠŸèƒ½çš„æ–¹å¼æ¥å…±åŒæ„å»ºç°ä»£åŒ– web åº”ç”¨çš„æŠ€æœ¯æ‰‹æ®µåŠæ–¹æ³•ç­–ç•¥ã€‚  å¾®å‰">
<meta name="twitter:image" content="https://blog.cn-face.com/images/micro.png">





  
  
  <link rel="canonical" href="https://blog.cn-face.com/2021/06/17/å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ(vue) | ä¸€è‚¡å¼±è€…çš„æ°”æ¯</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ä¸€è‚¡å¼±è€…çš„æ°”æ¯</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>é¦–é¡µ</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>æ ‡ç­¾</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>åˆ†ç±»</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>å½’æ¡£</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">

    
    
    
      
    

    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>ç«™ç‚¹åœ°å›¾</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>æœç´¢</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="æœç´¢..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/zhouxianjun" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.cn-face.com/2021/06/17/å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Alone zhou">
      <meta itemprop="description" content="ITç‹—ï¼Œç¨‹åºçŒ¿ï¼Œè‹¦Bå¥‹æ–—ä¸ºçš„ä¸­è€å¹´">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/5254523?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ä¸€è‚¡å¼±è€…çš„æ°”æ¯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ(vue)

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-06-17 10:31:56" itemprop="dateCreated datePublished" datetime="2021-06-17T10:31:56+08:00">2021-06-17</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-03-06 22:21:10" itemprop="dateModified" datetime="2024-03-06T22:21:10+08:00">2024-03-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯/" itemprop="url" rel="index"><span itemprop="name">å‰ç«¯</span></a></span>

                
                
                  ï¼Œ
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/å‰ç«¯/å¾®å‰ç«¯/" itemprop="url" rel="index"><span itemprop="name">å¾®å‰ç«¯</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             é˜…è¯»æ¬¡æ•°ï¼š 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
                
                <span title="æœ¬æ–‡å­—æ•°">17k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">16 åˆ†é’Ÿ</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ</h2><blockquote>
<p>Techniques, strategies and recipes for building a modern web app with multiple teams that can ship features independently. â€“ <a href="https://micro-frontends.org/" target="_blank" rel="noopener">Micro Frontends</a></p>
<p>å¾®å‰ç«¯æ˜¯ä¸€ç§å¤šä¸ªå›¢é˜Ÿé€šè¿‡ç‹¬ç«‹å‘å¸ƒåŠŸèƒ½çš„æ–¹å¼æ¥å…±åŒæ„å»ºç°ä»£åŒ– web åº”ç”¨çš„æŠ€æœ¯æ‰‹æ®µåŠæ–¹æ³•ç­–ç•¥ã€‚</p>
</blockquote>
<p>å¾®å‰ç«¯ï¼ˆMicro-Frontendsï¼‰æ˜¯ä¸€ç§ç±»ä¼¼äºå¾®æœåŠ¡çš„æ¶æ„ï¼Œå®ƒå°†å¾®æœåŠ¡çš„ç†å¿µåº”ç”¨äºæµè§ˆå™¨ç«¯ï¼Œå³å°† Web åº”ç”¨ç”±å•ä¸€çš„å•ä½“åº”ç”¨è½¬å˜ä¸ºå¤šä¸ªå°å‹å‰ç«¯åº”ç”¨èšåˆä¸ºä¸€çš„åº”ç”¨ã€‚å„ä¸ªå‰ç«¯åº”ç”¨è¿˜å¯ä»¥ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ï¼Œä»è€Œæ»¡è¶³ä¸šåŠ¡å¿«é€Ÿå˜åŒ–åŠåˆ†å¸ƒå¼å¤šå›¢é˜Ÿå¹¶è¡Œå¼€å‘çš„éœ€æ±‚ã€‚<br>å¾®å‰ç«¯ä¸æ˜¯å•çº¯çš„å‰ç«¯æ¡†æ¶æˆ–è€…å·¥å…·ï¼Œè€Œæ˜¯ä¸€å¥—æ¶æ„ä½“ç³»ï¼Œè¿™ä¸ªæ¦‚å¿µæœ€æ—©åœ¨2016å¹´åº•ç”±ThoughtWorksæå‡ºã€‚</p>
<h2 id="æ ¸å¿ƒä»·å€¼"><a href="#æ ¸å¿ƒä»·å€¼" class="headerlink" title="æ ¸å¿ƒä»·å€¼"></a>æ ¸å¿ƒä»·å€¼</h2><ul>
<li><p><strong>æŠ€æœ¯æ ˆæ— å…³</strong></p>
<p>ä¸»åº”ç”¨ä¸é™åˆ¶æ¥å…¥å­åº”ç”¨çš„æŠ€æœ¯æ ˆï¼Œå­åº”ç”¨æ‹¥æœ‰å®Œå…¨è‡ªä¸»æƒã€‚åº”ç”¨ä¹‹é—´ä¸åº”è¯¥æœ‰ä»»ä½•ç›´æ¥æˆ–é—´æ¥çš„æŠ€æœ¯æ ˆã€ä¾èµ–ã€ä»¥åŠå®ç°ä¸Šçš„è€¦åˆã€‚</p>
</li>
<li><p>ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²</p>
<p>å¾®åº”ç”¨ä»“åº“ç‹¬ç«‹ï¼Œå‰åç«¯å¯ç‹¬ç«‹å¼€å‘ï¼Œéƒ¨ç½²å®Œæˆåä¸»æ¡†æ¶è‡ªåŠ¨å®ŒæˆåŒæ­¥æ›´æ–°ã€‚ç‹¬ç«‹éƒ¨ç½²çš„èƒ½åŠ›åœ¨å¾®å‰ç«¯ä½“ç³»ä¸­è‡³å…³é‡è¦ï¼Œèƒ½å¤Ÿç¼©å°å˜æ›´èŒƒå›´ï¼Œè¿›è€Œé™ä½ç›¸å…³é£é™©ã€‚<br>å„ä¸ªå¾®å‰ç«¯éƒ½åº”è¯¥æœ‰è‡ªå·±çš„æŒç»­äº¤ä»˜ç®¡é“ï¼›è¿™äº›ç®¡é“å¯ä»¥å°†å¾®å‰ç«¯æ„å»ºã€æµ‹è¯•å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p>
</li>
<li><p>å¢é‡å‡çº§</p>
<p>åœ¨é¢å¯¹å„ç§å¤æ‚åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¾ˆéš¾å¯¹ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç³»ç»Ÿåšå…¨é‡çš„æŠ€æœ¯æ ˆå‡çº§æˆ–é‡æ„ï¼Œè€Œå¾®å‰ç«¯æ˜¯ä¸€ç§éå¸¸å¥½çš„å®æ–½æ¸è¿›å¼é‡æ„çš„æ‰‹æ®µå’Œç­–ç•¥ã€‚<br>é€æ¸å‡çº§æˆ‘ä»¬çš„æ¶æ„ã€ä¾èµ–å…³ç³»å’Œç”¨æˆ·ä½“éªŒã€‚å½“ä¸»æ¡†æ¶å‘ç”Ÿé‡å¤§å˜åŒ–æ—¶æ¯ä¸ªå¾®å‰ç«¯æ¨¡å—éƒ½å¯ä»¥æŒ‰éœ€å‡çº§ï¼Œä¸éœ€è¦æ•´ä½“ä¸‹çº¿æˆ–ä¸€æ¬¡æ€§å‡çº§æ‰€æœ‰å†…å®¹ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å°è¯•æ–°çš„æŠ€æœ¯æˆ–äº’åŠ¨æ¨¡å¼ï¼Œä¹Ÿèƒ½åœ¨éš”ç¦»åº¦æ›´å¥½çš„ç¯å¢ƒä¸‹åšè¯•éªŒã€‚</p>
</li>
<li><p>ç®€å•ã€è§£è€¦ã€æ˜“ç»´æŠ¤</p>
<p>å¾®å‰ç«¯æ¶æ„ä¸‹çš„ä»£ç åº“å€¾å‘äºæ›´å°/ç®€å•ã€æ›´å®¹æ˜“å¼€å‘ï¼Œé¿å…æ— å…³ç»„ä»¶ä¹‹é—´ä¸å¿…è¦çš„è€¦åˆï¼Œè®©ä»£ç æ›´ç®€æ´ã€‚é€šè¿‡ç•Œå®šæ¸…æ™°çš„åº”ç”¨è¾¹ç•Œæ¥é™ä½æ„å¤–è€¦åˆçš„å¯èƒ½æ€§ï¼Œæ›´å¥½åœ°é¿å…æ— æ„é—´é€ æˆçš„è¿™ç±»è€¦åˆé—®é¢˜ã€‚</p>
</li>
</ul>
<p>æ›´å¤šå‚è€ƒæ–‡çŒ®ï¼š</p>
<ul>
<li><a href="https://micro-frontends.org/" target="_blank" rel="noopener">Micro Frontends</a></li>
<li><a href="https://martinfowler.com/articles/micro-frontends.html" target="_blank" rel="noopener">Micro Frontends from martinfowler.com</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/95085796" target="_blank" rel="noopener">å¾®å‰ç«¯çš„æ ¸å¿ƒä»·å€¼</a></li>
</ul>
<h2 id="åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ"><a href="#åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ" class="headerlink" title="åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ"></a>åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ</h2><blockquote>
<p>å¾®å‰ç«¯æ¶æ„æ—¨åœ¨è§£å†³å•ä½“åº”ç”¨åœ¨ä¸€ä¸ªç›¸å¯¹é•¿çš„æ—¶é—´è·¨åº¦ä¸‹ï¼Œç”±äºå‚ä¸çš„äººå‘˜ã€å›¢é˜Ÿçš„å¢å¤šã€å˜è¿ï¼Œä»ä¸€ä¸ªæ™®é€šåº”ç”¨æ¼”å˜æˆä¸€ä¸ªå·¨çŸ³åº”ç”¨(Frontend Monolith)åï¼Œéšä¹‹è€Œæ¥çš„åº”ç”¨ä¸å¯ç»´æŠ¤çš„é—®é¢˜ã€‚è¿™ç±»é—®é¢˜åœ¨ä¼ä¸šçº§ Web åº”ç”¨ä¸­å°¤å…¶å¸¸è§ã€‚</p>
<ul>
<li>å…¼å®¹é—ç•™ç³»ç»Ÿ</li>
</ul>
</blockquote>
<p>  åœ¨ç°åœ¨æŠ€æœ¯ä¸æ–­æ›´è¿­ï¼Œä¿è¯æŠ€æœ¯æ ˆä¸è½åï¼Œéœ€è¦åœ¨å…¼å®¹å·²æœ‰ç³»ç»Ÿçš„å‰æä¸‹ï¼Œä½¿ç”¨æ–°æ¡†æ¶å»å¼€å‘æ–°åŠŸèƒ½ã€‚é—ç•™ç³»ç»ŸåŠŸèƒ½å·²ç»å®Œå–„ï¼Œå¹¶ä¸”ç¨³å®šè¿è¡Œï¼Œå›¢é˜Ÿæ²¡æœ‰å¿…è¦ï¼Œä¹Ÿæ²¡æœ‰ç²¾åŠ›å»å°†é—ç•™ç³»ç»Ÿé‡æ„ä¸€éã€‚æ­¤æ—¶å›¢é˜Ÿå¦‚æœéœ€è¦ä½¿ç”¨æ–°æ¡†æ¶ï¼Œæ–°æŠ€æœ¯å»å¼€å‘æ–°çš„åº”ç”¨ï¼Œä½¿ç”¨å¾®å‰ç«¯æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<ul>
<li><p>åº”ç”¨èšåˆ</p>
<p>å¤§å‹çš„äº’è”ç½‘å…¬å¸ï¼Œæˆ–å•†ä¸šSaaså¹³å°ï¼Œéƒ½ä¼šä¸ºç”¨æˆ·/å®¢æˆ·æä¾›å¾ˆå¤šåº”ç”¨å’ŒæœåŠ¡ï¼Œå¦‚ä½•ä¸ºç”¨æˆ·å‘ˆç°å…·æœ‰ç»Ÿä¸€ç”¨æˆ·ä½“éªŒå’Œä¸€ç«™å¼çš„åº”ç”¨èšåˆæˆä¸ºå¿…é¡»è§£å†³çš„é—®é¢˜ã€‚<br>å‰ç«¯èšåˆå·²æˆä¸ºä¸€ä¸ªæŠ€æœ¯è¶‹åŠ¿ï¼Œç›®å‰æ¯”è¾ƒç†æƒ³çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å¾®å‰ç«¯ã€‚</p>
</li>
<li><p>ä¸åŒå›¢é˜Ÿé—´å¼€å‘åŒä¸€ä¸ªåº”ç”¨æŠ€æœ¯æ ˆä¸åŒ</p>
<p>æŠŠç¬¬ä¸‰æ–¹çš„SaaSåº”ç”¨è¿›è¡Œé›†æˆæˆ–è€…æŠŠç¬¬ä¸‰æ–¹ç§æœåº”ç”¨è¿›è¡Œé›†æˆï¼ˆæ¯”å¦‚åœ¨å…¬å¸å†…éƒ¨éƒ¨ç½²çš„ gitlabï¼‰ç­‰ã€‚ä»¥åŠåœ¨å·²æœ‰å¤šä¸ªåº”ç”¨çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å°†å®ƒä»¬èšåˆä¸ºä¸€ä¸ªå•åº”ç”¨ã€‚<br><img src="/images/micro.png" alt></p>
</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯qiankunï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯qiankunï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯qiankunï¼Ÿ"></a>ä»€ä¹ˆæ˜¯qiankunï¼Ÿ</h2><p>qiankun æ˜¯ä¸€ä¸ªåŸºäº <a href="https://github.com/CanopyTax/single-spa" target="_blank" rel="noopener">single-spa</a> çš„<a href="https://micro-frontends.org/" target="_blank" rel="noopener">å¾®å‰ç«¯</a>å®ç°åº“ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶èƒ½æ›´ç®€å•ã€æ— ç—›çš„æ„å»ºä¸€ä¸ªç”Ÿäº§å¯ç”¨å¾®å‰ç«¯æ¶æ„ç³»ç»Ÿã€‚</p>
<p>qiankun å­µåŒ–è‡ªèš‚èšé‡‘èç§‘æŠ€åŸºäºå¾®å‰ç«¯æ¶æ„çš„äº‘äº§å“ç»Ÿä¸€æ¥å…¥å¹³å°ï¼Œåœ¨ç»è¿‡ä¸€æ‰¹çº¿ä¸Šåº”ç”¨çš„å……åˆ†æ£€éªŒåŠæ‰“ç£¨åï¼Œæˆ‘ä»¬å°†å…¶å¾®å‰ç«¯å†…æ ¸æŠ½å–å‡ºæ¥å¹¶å¼€æºï¼Œå¸Œæœ›èƒ½åŒæ—¶å¸®åŠ©ç¤¾åŒºæœ‰ç±»ä¼¼éœ€æ±‚çš„ç³»ç»Ÿæ›´æ–¹ä¾¿çš„æ„å»ºè‡ªå·±çš„å¾®å‰ç«¯ç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿå¸Œæœ›é€šè¿‡ç¤¾åŒºçš„å¸®åŠ©å°† qiankun æ‰“ç£¨çš„æ›´åŠ æˆç†Ÿå®Œå–„ã€‚</p>
<p>ç›®å‰ qiankun å·²åœ¨èš‚èšå†…éƒ¨æœåŠ¡äº†è¶…è¿‡ 200+ çº¿ä¸Šåº”ç”¨ï¼Œåœ¨æ˜“ç”¨æ€§åŠå®Œå¤‡æ€§ä¸Šï¼Œç»å¯¹æ˜¯å€¼å¾—ä¿¡èµ–çš„ã€‚</p>
<ul>
<li>ğŸ“¦ <strong>åŸºäº <a href="https://github.com/CanopyTax/single-spa" target="_blank" rel="noopener">single-spa</a></strong> å°è£…ï¼Œæä¾›äº†æ›´åŠ å¼€ç®±å³ç”¨çš„ APIã€‚</li>
<li>ğŸ“± <strong>æŠ€æœ¯æ ˆæ— å…³</strong>ï¼Œä»»æ„æŠ€æœ¯æ ˆçš„åº”ç”¨å‡å¯ ä½¿ç”¨/æ¥å…¥ï¼Œä¸è®ºæ˜¯ React/Vue/Angular/JQuery è¿˜æ˜¯å…¶ä»–ç­‰æ¡†æ¶ã€‚</li>
<li>ğŸ’ª <strong>HTML Entry æ¥å…¥æ–¹å¼</strong>ï¼Œè®©ä½ æ¥å…¥å¾®åº”ç”¨åƒä½¿ç”¨ iframe ä¸€æ ·ç®€å•ã€‚</li>
<li>ğŸ›¡â€‹ <strong>æ ·å¼éš”ç¦»</strong>ï¼Œç¡®ä¿å¾®åº”ç”¨ä¹‹é—´æ ·å¼äº’ç›¸ä¸å¹²æ‰°ã€‚</li>
<li>ğŸ§³ <strong>JS æ²™ç®±</strong>ï¼Œç¡®ä¿å¾®åº”ç”¨ä¹‹é—´ å…¨å±€å˜é‡/äº‹ä»¶ ä¸å†²çªã€‚</li>
<li>âš¡ï¸ <strong>èµ„æºé¢„åŠ è½½</strong>ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²æ—¶é—´é¢„åŠ è½½æœªæ‰“å¼€çš„å¾®åº”ç”¨èµ„æºï¼ŒåŠ é€Ÿå¾®åº”ç”¨æ‰“å¼€é€Ÿåº¦ã€‚</li>
<li>ğŸ”Œ <strong>umi æ’ä»¶</strong>ï¼Œæä¾›äº† <a href="https://github.com/umijs/plugins/tree/master/packages/plugin-qiankun" target="_blank" rel="noopener">@umijs/plugin-qiankun</a> ä¾› umi åº”ç”¨ä¸€é”®åˆ‡æ¢æˆå¾®å‰ç«¯æ¶æ„ç³»ç»Ÿã€‚<blockquote>
<p>æ‘˜è‡ªqiankunä»‹ç»</p>
</blockquote>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><h3 id="å­åº”ç”¨é™æ€èµ„æº404"><a href="#å­åº”ç”¨é™æ€èµ„æº404" class="headerlink" title="å­åº”ç”¨é™æ€èµ„æº404"></a>å­åº”ç”¨é™æ€èµ„æº404</h3></li>
</ul>
<ol>
<li>æ‰€æœ‰å›¾ç‰‡ç­‰é™æ€èµ„æºä¸Šä¼ è‡³ cdnï¼Œcss ä¸­ç›´æ¥å¼•ç”¨ cdn åœ°å€ï¼ˆæ¨èï¼‰</li>
<li><p>å°†å­—ä½“æ–‡ä»¶å’Œå›¾ç‰‡æ‰“åŒ…æˆ base64ï¼ˆé€‚ç”¨äºå­—ä½“æ–‡ä»¶å’Œå›¾ç‰‡ä½“ç§¯å°çš„é¡¹ç›®ï¼‰(ä½†æ€»æ˜¯æœ‰ä¸€äº›ä¸ç¬¦åˆè¦æ±‚çš„èµ„æºï¼Œè¯·ä½¿ç”¨ç¬¬ä¸‰ç§)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack config loader, æ·»åŠ ä»¥ä¸‹ruleåˆ°rulesä¸­</span></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(png|jpe?g|gif|webp|woff2?|eot|ttf|otf)$/i</span>,</span><br><span class="line">  use: [&#123;</span><br><span class="line">    loader: <span class="string">'url-loader'</span>,</span><br><span class="line">    options: &#123;&#125;,</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// chainWebpack</span></span><br><span class="line">config.module.rule(<span class="string">'fonts'</span>).use(<span class="string">'url-loader'</span>).loader(<span class="string">'url-loader'</span>).options(&#123;&#125;).end();</span><br><span class="line">config.module.rule(<span class="string">'images'</span>).use(<span class="string">'url-loader'</span>).loader(<span class="string">'url-loader'</span>).options(&#123;&#125;).end();</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨æ‰“åŒ…æ—¶ç»™å…¶æ³¨å…¥å®Œæ•´è·¯å¾„ï¼ˆé€‚ç”¨äºå­—ä½“æ–‡ä»¶å’Œå›¾ç‰‡ä½“ç§¯æ¯”è¾ƒå¤§çš„é¡¹ç›®ï¼‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> absolutePath = <span class="string">'å­åº”ç”¨ä¸‡ç»´ç½‘å¯è®¿é—®url'</span>;</span><br><span class="line"><span class="keyword">const</span> publicPath = <span class="string">`<span class="subst">$&#123;absolutePath&#125;</span><span class="subst">$&#123;config.output.get(<span class="string">'publicPath'</span>)&#125;</span>`</span>;</span><br><span class="line">    config.module</span><br><span class="line">      .rule(<span class="string">'fonts'</span>)</span><br><span class="line">      .use(<span class="string">'url-loader'</span>)</span><br><span class="line">      .loader(<span class="string">'url-loader'</span>)</span><br><span class="line">      .options(&#123;</span><br><span class="line">        limit: <span class="number">4096</span>, <span class="comment">// å°äº4kbå°†ä¼šè¢«æ‰“åŒ…æˆ base64</span></span><br><span class="line">        fallback: &#123;</span><br><span class="line">          loader: <span class="string">'file-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            name: <span class="string">'fonts/[name].[hash:8].[ext]'</span>,</span><br><span class="line">            publicPath</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .end();</span><br><span class="line">    config.module</span><br><span class="line">      .rule(<span class="string">'images'</span>)</span><br><span class="line">      .use(<span class="string">'url-loader'</span>)</span><br><span class="line">      .loader(<span class="string">'url-loader'</span>)</span><br><span class="line">      .options(&#123;</span><br><span class="line">        limit: <span class="number">4096</span>, <span class="comment">// å°äº4kbå°†ä¼šè¢«æ‰“åŒ…æˆ base64</span></span><br><span class="line">        fallback: &#123;</span><br><span class="line">          loader: <span class="string">'file-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            name: <span class="string">'img/[name].[hash:8].[ext]'</span>,</span><br><span class="line">            publicPath</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="cssæ ·å¼éš”ç¦»"><a href="#cssæ ·å¼éš”ç¦»" class="headerlink" title="cssæ ·å¼éš”ç¦»"></a>cssæ ·å¼éš”ç¦»</h3><p>é»˜è®¤æƒ…å†µqiankunä¼šè‡ªåŠ¨å¼€å¯æ²™ç®±æ¨¡å¼ï¼Œä½†è¿™ä¸ªæ¨¡å¼æ— æ³•éš”ç¦»ä¸»åº”ç”¨ä¸å­åº”ç”¨ã€æˆ–è€…åŒæ—¶åŠ è½½å¤šå­åº”ç”¨çš„åœºæ™¯ã€‚<br>qiankunè¿˜ç»™å‡ºäº†shadow domçš„æ–¹æ¡ˆï¼Œéœ€è¦é…ç½®<code>sandbox: { strictStyleIsolation: true }</code></p>
<blockquote>
<p>åŸºäº ShadowDOM çš„ä¸¥æ ¼æ ·å¼éš”ç¦»å¹¶ä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ— è„‘ä½¿ç”¨çš„æ–¹æ¡ˆï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½éœ€è¦æ¥å…¥åº”ç”¨åšä¸€äº›é€‚é…åæ‰èƒ½æ­£å¸¸åœ¨ ShadowDOM ä¸­è¿è¡Œèµ·æ¥æ¯”å¦‚ react åœºæ™¯ä¸‹éœ€è¦è§£å†³è¿™äº›<a href="https://github.com/facebook/react/issues/10422" target="_blank" rel="noopener">é—®é¢˜</a> ï¼Œä½¿ç”¨è€…éœ€è¦æ¸…æ¥šå¼€å¯äº† strictStyleIsolation æ„å‘³ç€ä»€ä¹ˆã€‚ä¸‹é¢ä¼šåˆ—å‡ºæˆ‘è§£å†³ShadowDomçš„ä¸€äº›æ¡ˆä¾‹ã€‚</p>
</blockquote>
<h3 id="js-æ²™ç®±"><a href="#js-æ²™ç®±" class="headerlink" title="js æ²™ç®±"></a>js æ²™ç®±</h3><p>ä¸»è¦æ˜¯éš”ç¦»æŒ‚è½½åœ¨<code>window</code>ä¸Šçš„å˜é‡ï¼Œè€Œqiankunå†…éƒ¨å·²ç»å¸®ä½ å¤„ç†å¥½äº†ã€‚åœ¨å­åº”ç”¨è¿è¡Œæ—¶è®¿é—®çš„<code>window</code>å…¶å®æ˜¯ä¸€ä¸ª<code>Proxy</code>ä»£ç†å¯¹è±¡ã€‚<br>æ‰€æœ‰å­åº”ç”¨çš„å…¨å±€å˜é‡å˜æ›´éƒ½æ˜¯åœ¨é—­åŒ…ä¸­äº§ç”Ÿçš„ï¼Œä¸ä¼šçœŸæ­£å›å†™åˆ° window ä¸Šï¼Œè¿™æ ·å°±èƒ½é¿å…å¤šå®ä¾‹ä¹‹é—´çš„æ±¡æŸ“äº†ã€‚<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy93Uk5sV0tuMEE1TXdpYWo4MmtYdmNCN09HaWFlVGljMkdOcjZEMEMxTFQ1Wmg0aWFpY2VpYVJRSVVSWk5sb01pYU8wVkQyNXQyUjdKR3JkNDNvOWY5ZHNOZTQwancvNjQw?x-oss-process=image/format,png" alt><br>`</p>
<h3 id="fix-shadow-dom"><a href="#fix-shadow-dom" class="headerlink" title="fix shadow dom"></a>fix shadow dom</h3><ul>
<li><p>getComputedStyle</p>
<p>å½“è·å–shadow domçš„è®¡ç®—æ ·å¼çš„æ—¶å€™ä¼ å…¥çš„elementæ˜¯<code>DocumentFragment</code>,ä¼šæŠ¥é”™ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getComputedStyle = <span class="built_in">window</span>.getComputedStyle;</span><br><span class="line"><span class="built_in">window</span>.getComputedStyle = <span class="function">(<span class="params">el, ...args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸ºshadow domåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (el <span class="keyword">instanceof</span> DocumentFragment) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Reflect</span>.apply(getComputedStyle, <span class="built_in">window</span>, [el, ...args]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>elementFromPoint</p>
<p>æ ¹æ®åæ ‡ï¼ˆx, yï¼‰å½“è·å–ä¸€ä¸ªå­åº”ç”¨çš„å…ƒç´ çš„æ—¶å€™ï¼Œä¼šè¿”å›shadow rootï¼Œå¹¶ä¸ä¼šè¿”å›çœŸæ­£çš„å…ƒç´ ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elementFromPoint = <span class="built_in">document</span>.elementFromPoint;</span><br><span class="line"><span class="built_in">document</span>.elementFromPoint = <span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.apply(elementFromPoint, <span class="keyword">this</span>, [x, y]);</span><br><span class="line">  <span class="comment">// å¦‚æœåæ ‡å…ƒç´ ä¸ºshadowåˆ™ç”¨è¯¥shadowå†æ¬¡è·å–</span></span><br><span class="line">  <span class="keyword">if</span> (result &amp;&amp; result.shadowRoot) &#123;</span><br><span class="line">    <span class="keyword">return</span> result.shadowRoot.elementFromPoint(x, y);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>document äº‹ä»¶ target ä¸ºshadow</p>
<p>å½“æˆ‘ä»¬åœ¨documentæ·»åŠ clickã€mousedownã€mouseupç­‰äº‹ä»¶çš„æ—¶å€™ï¼Œå›è°ƒå‡½æ•°ä¸­çš„<code>event.target</code>ä¸æ˜¯çœŸæ­£çš„ç›®æ ‡å…ƒç´ ï¼Œè€Œæ˜¯shadow rootå…ƒç´ ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fix: ç‚¹å‡»äº‹ä»¶targetä¸ºshadowå…ƒç´ çš„é—®é¢˜</span></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">addEventListener</span>: oldAddEventListener, <span class="attr">removeEventListener</span>: oldRemoveEventListener&#125; = <span class="built_in">document</span>;</span><br><span class="line"><span class="keyword">const</span> fixEvents = [<span class="string">'click'</span>, <span class="string">'mousedown'</span>, <span class="string">'mouseup'</span>];</span><br><span class="line"><span class="keyword">const</span> overrideEventFnMap = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> setOverrideEvent = <span class="function">(<span class="params">eventName, fn, overrideFn</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (fn === overrideFn) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!overrideEventFnMap[eventName]) &#123;</span><br><span class="line">    overrideEventFnMap[eventName] = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  overrideEventFnMap[eventName].set(fn, overrideFn);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> resetOverrideEvent = <span class="function">(<span class="params">eventName, fn</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> eventFn = overrideEventFnMap[eventName]?.get(fn);</span><br><span class="line">  <span class="keyword">if</span> (eventFn) &#123;</span><br><span class="line">    overrideEventFnMap[eventName].delete(fn);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> eventFn || fn;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">document</span>.addEventListener = <span class="function">(<span class="params">event, fn, options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> callback = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å½“å‰äº‹ä»¶å¯¹è±¡ä¸ºqiankunç›’å­ï¼Œå¹¶ä¸”å½“å‰å¯¹è±¡æœ‰shadowRootå…ƒç´ ï¼Œåˆ™fixäº‹ä»¶å¯¹è±¡ä¸ºçœŸå®å…ƒç´ </span></span><br><span class="line">    <span class="keyword">if</span> (e.target.id?.startsWith(<span class="string">'__qiankun_microapp_wrapper'</span>) &amp;&amp; e.target?.shadowRoot) &#123;</span><br><span class="line">      fn(&#123;...e, <span class="attr">target</span>: e.path[<span class="number">0</span>]&#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    fn(e);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> eventFn = fixEvents.includes(event) ? callback : fn;</span><br><span class="line">  setOverrideEvent(event, fn, eventFn);</span><br><span class="line">  <span class="built_in">Reflect</span>.apply(oldAddEventListener, <span class="built_in">document</span>, [event, eventFn, options]);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">document</span>.removeEventListener = <span class="function">(<span class="params">event, fn, options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> eventFn = resetOverrideEvent(event, fn);</span><br><span class="line">  <span class="built_in">Reflect</span>.apply(oldRemoveEventListener, <span class="built_in">document</span>, [event, eventFn, options]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="å¤ç”¨å…¬å…±ä¾èµ–"><a href="#å¤ç”¨å…¬å…±ä¾èµ–" class="headerlink" title="å¤ç”¨å…¬å…±ä¾èµ–"></a>å¤ç”¨å…¬å…±ä¾èµ–</h3><blockquote>
<p>æ¯”å¦‚ä¼ä¸šä¸­çš„utilã€coreã€requestã€uiç­‰å…¬å…±ä¾èµ–ï¼Œåœ¨å¾®å‰ç«¯ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ¯ä¸ªå­åº”ç”¨éƒ½åŠ è½½ä¸€æ¬¡ï¼Œè¿™æ ·æ—¢æµªè´¹èµ„æºå¹¶ä¸”è¿˜ä¼šå¯¼è‡´æœ¬æ¥å•ä¾‹çš„å¯¹è±¡ï¼Œå˜æˆäº†å¤šä¾‹ã€‚</p>
</blockquote>
<p>åœ¨webpackä¸­é…ç½®<code>externals</code>ã€‚æŠŠéœ€è¦å¤ç”¨çš„æ’é™¤æ‰“åŒ…ï¼Œç„¶ååœ¨<code>index.html</code>ä¸­åŠ è½½æ’é™¤çš„libå¤–é“¾ï¼ˆå­åº”ç”¨éœ€è¦åœ¨<code>script</code>æˆ–è€…<code>style</code>æ ‡ç­¾åŠ ä¸Š<code>ignore</code>å±æ€§ï¼Œæœ‰äº†è¿™ä¸ªå±æ€§ï¼Œqiankun ä¾¿ä¸ä¼šå†å»åŠ è½½è¿™ä¸ª js/cssï¼Œè€Œå­é¡¹ç›®ç‹¬ç«‹è¿è¡Œï¼Œè¿™äº› js/css ä»èƒ½è¢«åŠ è½½ï¼‰</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">ignore</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"//element-ui.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">ignore</span> <span class="attr">src</span>=<span class="string">"//element-ui.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">externals: &#123;</span><br><span class="line">  <span class="string">'element-ui'</span>: &#123;</span><br><span class="line">    commonjs: <span class="string">'element-ui'</span>,</span><br><span class="line">    commonjs2: <span class="string">'element-ui'</span>,</span><br><span class="line">    amd: <span class="string">'element-ui'</span>,</span><br><span class="line">    root: <span class="string">'ElementUI'</span> <span class="comment">// å¤–é“¾cdnåŠ è½½æŒ‚è½½åˆ°windowä¸Šçš„å˜é‡å</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="çˆ¶å­å…±äº«ï¼ˆå›½é™…åŒ–ï¼‰"><a href="#çˆ¶å­å…±äº«ï¼ˆå›½é™…åŒ–ï¼‰" class="headerlink" title="çˆ¶å­å…±äº«ï¼ˆå›½é™…åŒ–ï¼‰"></a>çˆ¶å­å…±äº«ï¼ˆå›½é™…åŒ–ï¼‰</h3><p>åº”ç”¨æ³¨å†Œæ—¶æˆ–åŠ è½½æ—¶ï¼Œå°†ä¾èµ–ä¼ é€’ç»™å­é¡¹ç›®<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œ</span></span><br><span class="line">registerMicroApps([</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'micro-1'</span>, </span><br><span class="line">    entry: <span class="string">'http://localhost:9001/micro-1'</span>, </span><br><span class="line">    container: <span class="string">'#micro-1'</span>, </span><br><span class="line">    activeRule: <span class="string">'/micro-1'</span>, </span><br><span class="line">    props: &#123; <span class="attr">i18n</span>: <span class="keyword">this</span>.$i18n &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"><span class="comment">// æ‰‹åŠ¨åŠ è½½</span></span><br><span class="line">loadMicroApp(&#123;</span><br><span class="line">  name,</span><br><span class="line">  entry,</span><br><span class="line">  container: <span class="string">`#<span class="subst">$&#123;<span class="keyword">this</span>.boxId&#125;</span>`</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    i18n: <span class="keyword">this</span>.$i18n</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>å­åº”ç”¨å¯åŠ¨æ—¶è·å–propså‚æ•°åˆå§‹åŒ–<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; i18n &#125; = props;</span><br><span class="line"><span class="keyword">if</span> (!i18n) &#123;</span><br><span class="line">  <span class="comment">// å½“ç‹¬ç«‹è¿è¡Œæ—¶æˆ–ä¸»åº”ç”¨æœªå…±äº«æ—¶ï¼ŒåŠ¨æ€åŠ è½½æœ¬åœ°å›½é™…åŒ–</span></span><br><span class="line">  <span class="keyword">const</span> <span class="built_in">module</span> = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'@/common-module/lang'</span>);</span><br><span class="line">  i18n = <span class="built_in">module</span>.default;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  i18n,</span><br><span class="line">  router,</span><br><span class="line">  render</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä¸»åº”ç”¨åœ¨æ³¨å†Œå­åº”ç”¨æˆ–è€…æ‰‹åŠ¨åŠ è½½å­åº”ç”¨æ—¶æŠŠå…±äº«çš„å˜é‡é€šè¿‡<code>props</code>ä¼ é€’ç»™å­åº”ç”¨ï¼Œå­åº”ç”¨åœ¨<code>bootstrap</code>æˆ–è€…<code>mount</code>é’©å­å‡½æ•°ä¸­è·å–ï¼Œå¦‚æœæ²¡æœ‰ä»<code>props</code>ä¸­è·å–åˆ°è¯¥å˜é‡ï¼Œå­åº”ç”¨åˆ™åŠ¨æ€åŠ è½½æœ¬åœ°å˜é‡ã€‚</p>
<h3 id="keep-aliveï¼ˆVueï¼‰"><a href="#keep-aliveï¼ˆVueï¼‰" class="headerlink" title="keep-aliveï¼ˆVueï¼‰"></a>keep-aliveï¼ˆVueï¼‰</h3><blockquote>
<p>å…¶å®å¹¶ä¸å»ºè®®åškeepAliveï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯åšäº†ï¼Œæˆ‘èƒ½è¯´ä»€ä¹ˆâ€¦</p>
</blockquote>
<p>ç½‘ä¸Šæœ‰å…¶ä»–æ–¹æ¡ˆï¼Œæˆ‘æ²¡æœ‰é‡‡çº³ï¼Œæˆ‘åœ¨è¿™é‡Œè¯´ä¸‹æˆ‘çš„æ–¹æ¡ˆå§ï¼ˆç»¼åˆäº†ç½‘ä¸Šçš„æ–¹æ¡ˆï¼‰ï¼Œä½¿ç”¨<code>loadMicroApp</code>æ‰‹åŠ¨åŠ è½½å’Œå¸è½½å­åº”ç”¨ã€‚è¿™é‡Œæœ‰å‡ ä¸ªéš¾ç‚¹ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// microApp.js (å¯ä»¥èµ°CI/CDè¿ç»´é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¥å£ä»æœåŠ¡å™¨è·å–)</span></span><br><span class="line"><span class="keyword">const</span> apps = [&#123;</span><br><span class="line">  name: <span class="string">'micro-1'</span>,</span><br><span class="line">  activeRule: <span class="string">'/micro-1'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  name: <span class="string">'micro-2'</span>,</span><br><span class="line">  activeRule: <span class="string">'/micro-2'</span>,</span><br><span class="line">  prefetch: <span class="literal">true</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  name: <span class="string">'micro-3'</span>,</span><br><span class="line">  activeRule: <span class="string">'/micro-3'</span>,</span><br><span class="line">  prefetch: <span class="literal">false</span>, <span class="comment">// é¢„åŠ è½½èµ„æº</span></span><br><span class="line">  preload: <span class="literal">false</span>, <span class="comment">// é¢„æ¸²æŸ“</span></span><br><span class="line">  keepalive: <span class="literal">true</span> <span class="comment">// ç¼“å­˜å­åº”ç”¨</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> apps.map(<span class="function"><span class="params">app</span> =&gt;</span> (&#123; ...app, <span class="attr">entry</span>: getEntryUrl(app.name) &#125;));</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div</span><br><span class="line">    v-show=&quot;isActive&quot;</span><br><span class="line">    :id=&quot;boxId&quot;</span><br><span class="line">    :class=&quot;b()&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; loadMicroApp &#125; from &apos;qiankun&apos;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &apos;MicroApp&apos;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    app: &#123;</span><br><span class="line">      type: Object,</span><br><span class="line">      required: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  inject: [&apos;appLayout&apos;],</span><br><span class="line">  computed: &#123;</span><br><span class="line">    boxId() &#123;</span><br><span class="line">      return `micro-app_$&#123;this.app.name&#125;`;</span><br><span class="line">    &#125;,</span><br><span class="line">    activeRule() &#123;</span><br><span class="line">      return this.app.activeRule;</span><br><span class="line">    &#125;,</span><br><span class="line">    currentPath() &#123;</span><br><span class="line">      return this.$route.fullPath;</span><br><span class="line">    &#125;,</span><br><span class="line">    // åˆ¤æ–­å½“å‰å­åº”ç”¨æ˜¯å¦ä¸ºæ¿€æ´»çŠ¶æ€</span><br><span class="line">    isActive() &#123;</span><br><span class="line">      const &#123;activeRule, currentPath&#125; = this;</span><br><span class="line">      const rules = Array.isArray(activeRule) ? [ ...activeRule ] : [activeRule];</span><br><span class="line">      return rules.some(rule =&gt; &#123;</span><br><span class="line">        if (typeof rule === &apos;function&apos;) &#123;</span><br><span class="line">          return rule(currentPath);</span><br><span class="line">        &#125;</span><br><span class="line">        return currentPath.startsWith(`$&#123;rule&#125;`);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    isKeepalive() &#123;</span><br><span class="line">      return this.app.keepalive;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    isActive: &#123;</span><br><span class="line">      handler() &#123;</span><br><span class="line">        this.onActiveChange();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created () &#123;</span><br><span class="line">    // éœ€è¦ç­‰spa startåå†åŠ è½½åº”ç”¨ï¼Œæ‰ä¼šæœ‰shadowèŠ‚ç‚¹</span><br><span class="line">    this.$once(&apos;started&apos;, () =&gt; &#123;</span><br><span class="line">      this.init();</span><br><span class="line">    &#125;);</span><br><span class="line">    // æŠŠå½“å‰å®ä¾‹åŠ å…¥åˆ°layoutä¸­</span><br><span class="line">    this.appLayout.apps.set(this.app.name, this);</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    init() &#123;</span><br><span class="line">      // é¢„æŒ‚è½½</span><br><span class="line">      if (this.app.preload) &#123;</span><br><span class="line">        this.load();</span><br><span class="line">      &#125;</span><br><span class="line">      // å¦‚æœè·¯ç”±ç›´æ¥è¿›å…¥å½“å‰åº”ç”¨åˆ™ä¼šåœ¨è¿™é‡ŒæŒ‚è½½</span><br><span class="line">      this.onActiveChange();</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * åŠ è½½å¾®åº”ç”¨</span><br><span class="line">     * @returns &#123;Promise&lt;void&gt;&#125;</span><br><span class="line">     */</span><br><span class="line">    async load() &#123;</span><br><span class="line">      if (!this.appInstance) &#123;</span><br><span class="line">        const &#123; name, entry, preload &#125; = this.app;</span><br><span class="line">        this.appInstance = loadMicroApp(&#123;</span><br><span class="line">          name,</span><br><span class="line">          entry,</span><br><span class="line">          container: `#$&#123;this.boxId&#125;`,</span><br><span class="line">          props: &#123;</span><br><span class="line">            ...,</span><br><span class="line">            appName: name,</span><br><span class="line">            preload,</span><br><span class="line">            active: this.isActive</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        await this.appInstance.mountPromise;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * çŠ¶æ€å˜æ›´</span><br><span class="line">     * @returns &#123;Promise&lt;void&gt;&#125;</span><br><span class="line">     */</span><br><span class="line">    async onActiveChange() &#123;</span><br><span class="line">      // è§¦å‘å…¨å±€äº‹ä»¶</span><br><span class="line">      this.eventBus.$emit(`$&#123;this.isActive ? &apos;activated&apos; : &apos;deactivated&apos;&#125;:$&#123;this.app.name&#125;`);</span><br><span class="line">      // å¦‚æœå½“å‰ä¸ºæ¿€æ´»åˆ™åŠ è½½</span><br><span class="line">      if (this.isActive) &#123;</span><br><span class="line">        await this.load();</span><br><span class="line">      &#125;</span><br><span class="line">      // å¦‚æœå½“å‰ä¸ºå¤±æ•ˆå¹¶ä¸”å½“å‰åº”ç”¨å·²åŠ è½½å¹¶ä¸”é…ç½®ä¸ºä¸ç¼“å­˜åˆ™å¸è½½å½“å‰åº”ç”¨</span><br><span class="line">      if (!this.isActive &amp;&amp; this.appInstance &amp;&amp; !this.isKeepalive) &#123;</span><br><span class="line">        await this.appInstance.unmount();</span><br><span class="line">        this.appInstance = null;</span><br><span class="line">      &#125;</span><br><span class="line">      // é€šçŸ¥å¸ƒå±€å½“å‰çŠ¶æ€å˜æ›´</span><br><span class="line">      this.$emit(&apos;active&apos;, this.isActive);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// App.vue (layout)</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;template v-if=&quot;!isMicroApp&quot;&gt;</span><br><span class="line">    &lt;keep-alive&gt;</span><br><span class="line">      &lt;router-view v-if=&quot;keepAlive&quot; /&gt;</span><br><span class="line">    &lt;/keep-alive&gt;</span><br><span class="line">    &lt;router-view v-if=&quot;!keepAlive&quot; /&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">  &lt;micro-app</span><br><span class="line">    v-for=&quot;app of microApps&quot;</span><br><span class="line">    :key=&quot;app.name&quot;</span><br><span class="line">    :app=&quot;app&quot;</span><br><span class="line">    @active=&quot;onMicroActive&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    isMicroApp() &#123;</span><br><span class="line">      return !!this.currentMicroApp;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    // å¯åŠ¨qiankunä¸»åº”ç”¨ï¼Œå¼€å¯å¤šä¾‹ä¸ä¸¥æ ¼æ ·å¼éš”ç¦»æ²™ç®±ï¼ˆshadow domï¼‰</span><br><span class="line">    start(&#123; singular: false, sandbox: &#123; strictStyleIsolation: true &#125; &#125;);</span><br><span class="line">    // è¿‡æ»¤å‡ºéœ€è¦é¢„åŠ è½½çš„å­åº”ç”¨è¿›è¡Œèµ„æºé¢„åŠ è½½</span><br><span class="line">    const prefetchAppList = this.microApps.filter(item =&gt; item.prefetch);</span><br><span class="line">    if (prefetchAppList.length) &#123;</span><br><span class="line">      // å»¶è¿Ÿæ‰§è¡Œï¼Œæ”¾ç½®å½±å“å½“å‰è®¿é—®çš„åº”ç”¨èµ„æºåŠ è½½</span><br><span class="line">      (window.requestIdleCallback || setTimeout)(() =&gt; prefetchApps(prefetchAppList));</span><br><span class="line">    &#125;</span><br><span class="line">    // è§¦å‘å¾®åº”ç”¨çš„åˆå§‹åŒ–äº‹ä»¶ï¼Œä»£è¡¨spaå·²ç»startedäº†</span><br><span class="line">    this.appValues.forEach(app =&gt; app.$emit(&apos;started&apos;));</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onMicroActive() &#123;</span><br><span class="line">      this.currentMicroApp = this.appValues.find(item =&gt; item.isActive);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>è·¯ç”±çš„å“åº”ï¼Œå¦‚æœæˆ‘ä»¬ä¸å¸è½½keepAliveçš„å­åº”ç”¨ï¼Œåˆ™å­åº”ç”¨ä¾ç„¶ä¼šå“åº”è·¯ç”±çš„å˜åŒ–ï¼Œä»è€Œå¯¼è‡´å­åº”ç”¨çš„å½“å‰è·¯ç”±å·²ç»ä¸æ˜¯ç¦»å¼€æ—¶çš„è·¯ç”±äº†ã€‚</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®©vue-routeræ”¯æŒkeepaliveï¼Œå½“ä¸»è·¯ç”±å˜æ›´æ—¶å¦‚æœå½“å‰å­åº”ç”¨æ²¡æœ‰è¯¥è·¯ç”±åˆ™ä¸åšå¤„ç†</span></span><br><span class="line"><span class="comment"> * å› ä¸ºé€šè¿‡æµè§ˆå™¨å‰è¿›åé€€ä¼šå…ˆè§¦å‘ä¸»è·¯ç”±çš„ç›‘å¬ï¼Œå¯¼è‡´æ²¡æœ‰åŠæ—¶é€šçŸ¥åˆ°å­åº”ç”¨deactivatedï¼Œåˆ™å­åº”ç”¨è·¯ç”±æ²¡æœ‰åŠæ—¶åœæ­¢ç›‘å¬ï¼Œåˆ™ä¼šå¤„ç†æœ¬æ¬¡ä¸»è·¯ç”±å˜æ›´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">router</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> supportKeepAlive = <span class="function">(<span class="params">router</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> old = router.history.transitionTo;</span><br><span class="line">  router.history.transitionTo = <span class="function">(<span class="params">location, cb</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> matched = router.getMatchedComponents(location);</span><br><span class="line">    <span class="keyword">if</span> (!matched || !matched.length) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Reflect</span>.apply(old, router.history, [location, cb]);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// é‡å†™ç›‘å¬è·¯ç”±å˜æ›´äº‹ä»¶</span></span><br><span class="line">supportKeepAlive(instance.$router);</span><br><span class="line"><span class="comment">// å¦‚æœä¸ºé¢„æŒ‚è½½å¹¶ä¸”å½“å‰ä¸ä¸ºæ¿€æ´»çŠ¶æ€åˆ™åœæ­¢ç›‘å¬è·¯ç”±ï¼Œå¹¶è®¾ç½®_startLocationä¸ºç©ºï¼Œä¸ºäº†åœ¨æ¿€æ´»çš„æ—¶å€™å¯ä»¥å“åº”</span></span><br><span class="line"><span class="keyword">if</span> (preload &amp;&amp; !active) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå½“å‰å­åº”ç”¨ä¸æ˜¯é¢„åŠ è½½ï¼ˆæˆ‘è¿™é‡Œåšäº†å¤šä¸ªå­åº”ç”¨å¹¶å­˜ä¸”å¯ä»¥é¢„åŠ è½½ï¼‰ï¼Œå¹¶ä¸”è®¿é—®çš„ä¸æ˜¯å½“å‰å­åº”ç”¨åˆ™æŠŠè·¯ç”±åœæ­¢</span></span><br><span class="line">  instance.$router.history.teardown();</span><br><span class="line">  instance.$router.history._startLocation = <span class="string">''</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>é¡µé¢çš„<code>activated</code>ä¸<code>deactivated</code>è§¦å‘ã€‚<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å­åº”ç”¨åˆ›å»ºçš„æ—¶å€™ç›‘å¬æ¿€æ´»ä¸å¤±æ•ˆäº‹ä»¶</span></span><br><span class="line"><span class="keyword">if</span> (eventBus) &#123;</span><br><span class="line">  eventBus.$on(<span class="string">`activated:<span class="subst">$&#123;appName&#125;</span>`</span>, activated);</span><br><span class="line">  eventBus.$on(<span class="string">`deactivated:<span class="subst">$&#123;appName&#125;</span>`</span>, deactivated);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å½“å‰è·¯ç”±çš„ç»„ä»¶</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getCurrentRouteInstance = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;matched&#125; = instance?.$route || &#123;&#125;;</span><br><span class="line">  <span class="keyword">if</span> (matched?.length) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; instances &#125; = matched[matched.length - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> (instances) &#123;</span><br><span class="line">      <span class="keyword">return</span> instances.default || instances;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§¦å‘å½“å‰è·¯ç”±ç»„ä»¶hook</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="variable">hook</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> fireCurrentRouterInstanceHook = <span class="function">(<span class="params">hook</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> com = getCurrentRouteInstance();</span><br><span class="line">  <span class="keyword">const</span> fns = com?.$options?.[hook];</span><br><span class="line">  <span class="keyword">if</span> (fns) &#123;</span><br><span class="line">    fns.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> <span class="built_in">Reflect</span>.apply(fn, com, [&#123; <span class="attr">micro</span>: <span class="literal">true</span> &#125;]));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¿€æ´»å½“å‰å­åº”ç”¨å›è°ƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> activated = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  instance?.$router.history.setupListeners();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'setupListeners'</span>);</span><br><span class="line">  fireCurrentRouterInstanceHook(<span class="string">'activated'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¢« keep-alive ç¼“å­˜çš„ç»„ä»¶åœç”¨æ—¶è°ƒç”¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> deactivated = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  instance?.$router.history.teardown();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'teardown'</span>);</span><br><span class="line">  fireCurrentRouterInstanceHook(<span class="string">'deactivated'</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="vuex-å…¨å±€çŠ¶æ€å…±äº«ï¼ˆæ…ç”¨ï¼Œç ´åäº†vuexçš„ç†å¿µ-ä¸é€‚ç”¨ä¸å¤§é‡çš„æ•°æ®ï¼‰"><a href="#vuex-å…¨å±€çŠ¶æ€å…±äº«ï¼ˆæ…ç”¨ï¼Œç ´åäº†vuexçš„ç†å¿µ-ä¸é€‚ç”¨ä¸å¤§é‡çš„æ•°æ®ï¼‰" class="headerlink" title="vuex å…¨å±€çŠ¶æ€å…±äº«ï¼ˆæ…ç”¨ï¼Œç ´åäº†vuexçš„ç†å¿µ, ä¸é€‚ç”¨ä¸å¤§é‡çš„æ•°æ®ï¼‰"></a>vuex å…¨å±€çŠ¶æ€å…±äº«ï¼ˆæ…ç”¨ï¼Œç ´åäº†vuexçš„ç†å¿µ, ä¸é€‚ç”¨ä¸å¤§é‡çš„æ•°æ®ï¼‰</h3><blockquote>
<p>å­åº”ç”¨ä½¿ç”¨è‡ªå·±çš„vuexã€‚å¹¶ä¸æ˜¯çœŸæ­£çš„ä½¿ç”¨ä¸»åº”ç”¨çš„vuexã€‚éœ€è¦æ­å–œçš„vuexæ¨¡å—ä¸»åº”ç”¨ä¸å­åº”ç”¨ç†è®ºæ¥è¯´æ˜¯å¼•ç”¨çš„ç›¸åŒçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªvuexæ¨¡å—æ ‡è®°å®ƒæ˜¯å¦éœ€è¦å…±äº«<br>å¹¶watchä¸»åº”ç”¨ä¸å­åº”ç”¨çš„è¯¥æ¨¡å—ã€‚å½“å­åº”ç”¨ä¸­çš„stateå‘ç”Ÿäº†æ”¹å˜åˆ™æ›´æ–°ä¸»åº”ç”¨çš„stateï¼Œç›¸åä¸»åº”ç”¨çš„stateå˜æ›´åä¹ŸåŒæ ·ä¿®æ”¹å­åº”ç”¨çš„stateã€‚</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å‘½åç©ºé—´çŠ¶æ€æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>state çŠ¶æ€æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param </span>namespace å‘½åç©ºé—´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getNamespaceState = <span class="function">(<span class="params">state, namespace</span>) =&gt;</span> namespace === <span class="string">'root'</span> ? state : <span class="keyword">get</span>(state, namespace);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ›´æ–°çŠ¶æ€æ•°æ®</span><br><span class="line"> * @param store çŠ¶æ€å­˜å‚¨</span><br><span class="line"> * @param namespace å‘½åç©ºé—´</span><br><span class="line"> * @param value æ–°çš„å€¼</span><br><span class="line"> * @returns &#123;*&#125;</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">const updateStoreState = (store, namespace, value) =&gt; store._withCommit(() =&gt; setVo(getNamespaceState(store.state, namespace), value));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span>**</span><br><span class="line"> * ç›‘å¬çŠ¶æ€å­˜å‚¨</span><br><span class="line"> * @param store çŠ¶æ€å­˜å‚¨</span><br><span class="line"> * @param fn å˜æ›´äº‹ä»¶å‡½æ•°</span><br><span class="line"> * @param namespace å‘½åç©ºé—´</span><br><span class="line"> * @returns &#123;*&#125;</span><br><span class="line"> * @private</span><br><span class="line"> *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">const _watch = (store, fn, namespace) =&gt; store.watch(state =&gt; getNamespaceState(state, namespace), fn, &#123; deep: true &#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const updateSubStoreState = (stores, ns, value) =&gt; stores.filter(s =&gt; s.__shareNamespaces.has(ns)).forEach(s =&gt; updateStoreState(s, ns, value));</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default (store, mainStore) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ å¦‚æœæœ‰ä¸»åº”ç”¨å­˜å‚¨åˆ™å¼€å¯å…±äº«</span></span><br><span class="line"><span class="regexp">  if (mainStore) &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ å¤šä¸ªå­åº”ç”¨ä¸ä¸»åº”ç”¨å…±äº«æ—¶åˆ¤æ–­ä¸»åº”ç”¨å­˜å‚¨æ˜¯å¦å·²ç»æ ‡è®°ä¸ºå·²å…±äº«</span></span><br><span class="line"><span class="regexp">    if (mainStore.__isShare !== true) &#123;</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ æ‰€æœ‰å­åº”ç”¨çŠ¶æ€</span></span><br><span class="line"><span class="regexp">      mainStore.__subStores = new Set();</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ å·²ç›‘å¬çš„å‘½åç©ºé—´</span></span><br><span class="line"><span class="regexp">      mainStore.__subWatchs = new Map();</span></span><br><span class="line"><span class="regexp">      mainStore.__isShare = true;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ æŠŠå½“å‰å­åº”ç”¨å­˜å‚¨æ”¾å…¥ä¸»åº”ç”¨é‡Œé¢</span></span><br><span class="line"><span class="regexp">    mainStore.__subStores.add(store);</span></span><br><span class="line"><span class="regexp">    const shareNames = new Set();</span></span><br><span class="line"><span class="regexp">    const &#123; _modulesNamespaceMap: moduleMap &#125; = store;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ ç›‘å¬å½“å‰storeï¼Œæ›´æ–°ä¸»åº”ç”¨storeï¼Œå¹¶ç»Ÿè®¡è¯¥å­åº”ç”¨éœ€è¦å…±äº«çš„æ‰€æœ‰å‘½åç©ºé—´</span></span><br><span class="line"><span class="regexp">    Object.keys(moduleMap).forEach(key =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      const names = key.split('/</span><span class="string">').filter(k =&gt; !!k);</span></span><br><span class="line"><span class="string">      // å¦‚æœè¯¥å‘½åç©ºé—´çš„ä¸Šçº§å‘½åç©ºé—´å·²ç»å…±äº«åˆ™ä¸‹çº§ä¸éœ€è¦å†å…±äº«</span></span><br><span class="line"><span class="string">      const has = names.some(name =&gt; shareNames.has(name));</span></span><br><span class="line"><span class="string">      if (has) &#123;</span></span><br><span class="line"><span class="string">        return;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      const &#123; _rawModule: &#123; share &#125; &#125; = moduleMap[key];</span></span><br><span class="line"><span class="string">      if (share === true) &#123;</span></span><br><span class="line"><span class="string">        const namespace = names.join('</span>.<span class="string">');</span></span><br><span class="line"><span class="string">        // ç›‘å¬å½“å‰å­åº”ç”¨å­˜å‚¨çš„å‘½åç©ºé—´ï¼Œå‘ç”Ÿå˜åŒ–åæ›´æ–°ä¸»åº”ç”¨ä¸ä¹‹åŒåçš„å‘½åç©ºé—´æ•°æ®</span></span><br><span class="line"><span class="string">        _watch(store, value =&gt; updateStoreState(mainStore, namespace, value), namespace);</span></span><br><span class="line"><span class="string">        shareNames.add(namespace);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    // å­˜å‚¨å½“å‰å­åº”ç”¨éœ€è¦å…±äº«çš„å‘½åç©ºé—´</span></span><br><span class="line"><span class="string">    store.__shareNamespaces = shareNames;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    shareNames.forEach(ns =&gt; &#123;</span></span><br><span class="line"><span class="string">      // ä»ä¸»åº”ç”¨åŒæ­¥æ•°æ®</span></span><br><span class="line"><span class="string">      updateStoreState(store, ns, getNamespaceState(mainStore.state, ns));</span></span><br><span class="line"><span class="string">      if (mainStore.__subWatchs.has(ns)) &#123;</span></span><br><span class="line"><span class="string">        return;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      // ç›‘å¬ä¸»åº”ç”¨çš„çŠ¶æ€ï¼Œæ›´æ–°å­åº”ç”¨å­˜å‚¨</span></span><br><span class="line"><span class="string">      const w = mainStore.watch(state =&gt; getNamespaceState(state, ns), value =&gt; updateSubStoreState([...mainStore.__subStores], ns, value), &#123; deep: true &#125;);</span></span><br><span class="line"><span class="string">      console.log(`ä¸»åº”ç”¨storeç›‘å¬æ¨¡å—ã€$&#123;ns&#125;ã€‘æ•°æ®`);</span></span><br><span class="line"><span class="string">      mainStore.__subWatchs.set(ns, w);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  return store;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    
      
    
    

    
      <div>
        




  



<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Alone zhou</li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    
    <a href="https://blog.cn-face.com/2021/06/17/å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ/" title="å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ(vue)">https://blog.cn-face.com/2021/06/17/å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/single-spa/" rel="tag"># single spa</a>
          
            <a href="/tags/qiankun/" rel="tag"># qiankun</a>
          
            <a href="/tags/å¾®å‰ç«¯/" rel="tag"># å¾®å‰ç«¯</a>
          
            <a href="/tags/ä¹¾å¤/" rel="tag"># ä¹¾å¤</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/07/07/vue-history-å¤šæ¨¡å—nginxé…ç½®/" rel="next" title="vue history å¤šæ¨¡å—nginxé…ç½®">
                <i class="fa fa-chevron-left"></i> vue history å¤šæ¨¡å—nginxé…ç½®
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MzkwOS8yMDQ0NQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars2.githubusercontent.com/u/5254523?s=460&v=4" alt="Alone zhou">
            
              <p class="site-author-name" itemprop="name">Alone zhou</p>
              <div class="site-description motion-element" itemprop="description">ITç‹—ï¼Œç¨‹åºçŒ¿ï¼Œè‹¦Bå¥‹æ–—ä¸ºçš„ä¸­è€å¹´</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/zhouxianjun" title="GitHub &rarr; https://github.com/zhouxianjun" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:715213471@qq.com" title="E-Mail &rarr; mailto:715213471@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ"><span class="nav-number">1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯å¾®å‰ç«¯ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ ¸å¿ƒä»·å€¼"><span class="nav-number">2.</span> <span class="nav-text">æ ¸å¿ƒä»·å€¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ"><span class="nav-number">3.</span> <span class="nav-text">åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»€ä¹ˆæ˜¯qiankunï¼Ÿ"><span class="nav-number">4.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯qiankunï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é‡åˆ°çš„é—®é¢˜"><span class="nav-number">5.</span> <span class="nav-text">é‡åˆ°çš„é—®é¢˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å­åº”ç”¨é™æ€èµ„æº404"><span class="nav-number">5.1.</span> <span class="nav-text">å­åº”ç”¨é™æ€èµ„æº404</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cssæ ·å¼éš”ç¦»"><span class="nav-number">5.2.</span> <span class="nav-text">cssæ ·å¼éš”ç¦»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#js-æ²™ç®±"><span class="nav-number">5.3.</span> <span class="nav-text">js æ²™ç®±</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fix-shadow-dom"><span class="nav-number">5.4.</span> <span class="nav-text">fix shadow dom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¤ç”¨å…¬å…±ä¾èµ–"><span class="nav-number">5.5.</span> <span class="nav-text">å¤ç”¨å…¬å…±ä¾èµ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#çˆ¶å­å…±äº«ï¼ˆå›½é™…åŒ–ï¼‰"><span class="nav-number">5.6.</span> <span class="nav-text">çˆ¶å­å…±äº«ï¼ˆå›½é™…åŒ–ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keep-aliveï¼ˆVueï¼‰"><span class="nav-number">5.7.</span> <span class="nav-text">keep-aliveï¼ˆVueï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vuex-å…¨å±€çŠ¶æ€å…±äº«ï¼ˆæ…ç”¨ï¼Œç ´åäº†vuexçš„ç†å¿µ-ä¸é€‚ç”¨ä¸å¤§é‡çš„æ•°æ®ï¼‰"><span class="nav-number">5.8.</span> <span class="nav-text">vuex å…¨å±€çŠ¶æ€å…±äº«ï¼ˆæ…ç”¨ï¼Œç ´åäº†vuexçš„ç†å¿µ, ä¸é€‚ç”¨ä¸å¤§é‡çš„æ•°æ®ï¼‰</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
<img style="height: 24px; display: inline-block; vertical-align: middle;" src="/images/beian.png">
<a href="https://beian.mps.gov.cn/#/query/webSearch?code=43011202000963" rel="noreferrer" target="_blank">æ¹˜å…¬ç½‘å®‰å¤‡43011202000963</a>
&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alone zhou</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="ç«™ç‚¹æ€»å­—æ•°">52k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">48 åˆ†é’Ÿ</span>
  
</div>

  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.1.0</div>




<span class="post-meta-divider">|</span>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">åšå®¢å…¨ç«™å…±12.2kå­—</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="æ€»è®¿å®¢é‡">
      è®¿å®¢è®¿é—®æ¬¡æ•°ï¼š<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="æ€»è®¿é—®é‡">
      ç«™ç‚¹æµè§ˆé‡ï¼š<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>



  
  <script src="/js/scrollspy.js?v=7.1.0"></script>
<script src="/js/post-details.js?v=7.1.0"></script>



  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  


  
    <script>
  window.livereOptions = {
    refer: '2021/06/17/å¾®å‰ç«¯ï¼ˆqiankunï¼‰å°é²œ/'
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
